<?php include 'views/_common/stats-switcher.phtml'; ?>

<div class="users">
<?php foreach ($this->users as $i => $u): ?>
	<div class="user">
		<h2>
			<a href="<?php echo $this->mgHelper->url('stats/' . $this->actionName, ['u' => $u['user-name'], 'am' => $this->am]) ?>">
				<?php echo $u['user-name'] ?></a>
			`s <?php echo $this->am ?> list
		</h2>

		<?php if (empty($u[$this->am]['entries'])): ?>
			<p>This user doesn't seem to have anything on their list.</p>
		<?php else: ?>
			<div class="table">
				<table>
					<thead>
						<tr>
							<th class="ord">#</th>

							<th class="status" title="Status">
								<a href="<?php echo $this->mgHelper->url('stats/' . $this->actionName, ['u' => $this->userNames, 'am' => $this->am, 'sort-column' => 'status', 'sort-dir' => $this->sortColumn == 'status' ? 1 - $this->sortDir : 0]) ?>">
									S
								</a>
							</th>

							<?php if (count($this->users) > 1): ?>
								<th class="unique" title="Unique - marked with &bdquo;+&rdquo; if only this user has given title in their list.">
									<a href="<?php echo $this->mgHelper->url('stats/' . $this->actionName, ['u' => $this->userNames, 'am' => $this->am, 'sort-column' => 'unique', 'sort-dir' => $this->sortColumn == 'unique' ? 1 - $this->sortDir : 0]) ?>">
										U
									</a>
								</th>
							<?php endif ?>

							<th class="title">
								<a href="<?php echo $this->mgHelper->url('stats/' . $this->actionName, ['u' => $this->userNames, 'am' => $this->am, 'sort-column' => 'title', 'sort-dir' => $this->sortColumn == 'title' ? 1 - $this->sortDir : 0]) ?>">
									Title
								</a>
							</th>

							<th class="score">
								<a href="<?php echo $this->mgHelper->url('stats/' . $this->actionName, ['u' => $this->userNames, 'am' => $this->am, 'sort-column' => 'score', 'sort-dir' => $this->sortColumn == 'score' ? 1 - $this->sortDir : 0]) ?>">
									Score
								</a>
							</th>
						</tr>
					</thead>

					<tbody>
						<?php $k = 1 ?>
						<?php foreach ($u[$this->am]['entries'] as $e): ?>
							<tr>
								<td class="ord"><?php echo $k ++ ?></td>

								<?php include 'views/_common/stats-table-status.phtml' ?>
								<?php include 'views/_common/stats-table-unique.phtml' ?>
								<?php include 'views/_common/stats-table-title.phtml' ?>

								<?php if (!empty($e2)): ?>
									<?php if ($e['user']['score'] > $e2['user']['score']): ?>
										<td class="score higher-score">
									<?php elseif ($e['user']['score'] < $e2['user']['score']): ?>
										<td class="score lower-score">
									<?php else: ?>
										<td class="score same-score">
									<?php endif ?>
								<?php else: ?>
									<td class="score">
								<?php endif ?>
									<?php if (empty($e['user']['score'])): ?>
										-
									<?php else: ?>
										<?php echo $e['user']['score'] ?>
									<?php endif ?>
								</td>

							</tr>
						<?php endforeach ?>
					</tbody>
				</table>
			</div>
		<?php endif ?>

	</div>
<?php endforeach ?>
<div class="clear"></div>
</div>

<script type="text/javascript">
$('*').tooltip();
</script>
