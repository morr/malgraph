<div class="section">
	<h2>
		<a href="<?php echo $this->mgHelper->constructUrl(null, null, [], $this->user['link-name']) ?>">
			<?php echo $this->user['visible-name'] ?>
		</a>
		&rsquo;s <?php echo $this->mgHelper->amText() ?> list
	</h2>

	<div class="section-body">
		<?php if (empty($this->user[$this->am]['entries'])): ?>
			<p>This user doesn&rsquo;t seem to have anything on their list.</p>
		<?php elseif ($this->user[$this->am]['private']): ?>
			<p><?php echo ucfirst($this->mgHelper->amText()) ?> list of this user is private.<br>Each of us has some dirty secrets, isn&rsquo;t that right?</p>
		<?php else: ?>
			<div class="table">
				<table class="tablesorter">
					<thead>
						<tr>
							<th class="status tooltipable"
								data-title="Status"
								data-position-my="center bottom"
								data-position-at="center top"
							>
								S
							</th>

							<?php if (count($this->view->users) > 1): ?>
								<th class="unique tooltipable"
									data-title="Unique - marked with &bdquo;+&rdquo; if only this user has given title in their list."
									data-position-my="center bottom"
									data-position-at="center top"
								>
									U
								</th>
							<?php endif ?>

							<th class="title">
								Title
							</th>

							<th class="score">
								Score
							</th>
						</tr>
					</thead>

					<tbody>
						<?php $k = 1 ?>
						<?php foreach ($this->user[$this->am]['entries'] as $e): ?>
							<?php if ($e['user']['unique']): ?>
								<tr class="unique">
							<?php else: ?>
								<tr>
							<?php endif ?>

								<?php if ($e['user']['status'] == UserModel::USER_LIST_STATUS_PLANNED): ?>
									<td class="status tooltipable" data-title="<?php echo $this->mgHelper->statusText($e['user']['status']) ?>" data-sorter="4">
										<i class="icon-schedule"></i>
								<?php elseif ($e['user']['status'] == UserModel::USER_LIST_STATUS_DROPPED): ?>
									<td class="status tooltipable" data-title="<?php echo $this->mgHelper->statusText($e['user']['status']) ?>" data-sorter="5">
										<i class="icon-cross"></i>
								<?php elseif ($e['user']['status'] == UserModel::USER_LIST_STATUS_WATCHING): ?>
									<td class="status tooltipable" data-title="<?php echo $this->mgHelper->statusText($e['user']['status']) ?>" data-sorter="1">
										<i class="icon-eye"></i>
								<?php elseif ($e['user']['status'] == UserModel::USER_LIST_STATUS_ONHOLD): ?>
									<td class="status tooltipable" data-title="<?php echo $this->mgHelper->statusText($e['user']['status']) ?>" data-sorter="3">
										<i class="icon-hourglass"></i>
								<?php elseif ($e['user']['status'] == UserModel::USER_LIST_STATUS_COMPLETED): ?>
									<td class="status tooltipable" data-title="<?php echo $this->mgHelper->statusText($e['user']['status']) ?>" data-sorter="2">
										<i class="icon-tick"></i>
								<?php endif ?>
								</td>

								<?php if (count($this->view->users) > 1): ?>
									<?php if ($e['user']['unique']): ?>
										<td class="unique tooltipable" data-title="Only this user has this title on his list" data-sorter="1">
											<i class="icon-plus"></i>
									<?php else: ?>
										<td class="unique tooltipable" data-title="Both users have this title on their lists" data-sorter="0">
											<i class="icon-dot"></i>
									<?php endif ?>
									</td>
								<?php endif ?>

								<td class="title" data-sorter="<?php echo $e['full']['title'] ?>">
									<a href="http://myanimelist.net/<?php echo $this->view->mgHelper->amText() ?>/<?php echo $e['full']['id'] ?>">
										<?php echo $e['full']['title'] ?>
									</a>
								</td>

								<?php if (!empty($e['others']) and count($e['others']) == 1): ?>
									<?php $e2 = reset($e['others']) ?>
									<?php if ($e['user']['score'] > $e2['user']['score']): ?>
										<?php if ($e2['user']['score'] > 0): ?>
											<td class="score higher-score tooltipable" data-title="This title was rated lower (<?php echo $e2['user']['score'] ?>) by the other user." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php else: ?>
											<td class="score no-score tooltipable" data-title="This title wasn&rsquo;t rated by the other user." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php endif ?>
									<?php elseif ($e['user']['score'] < $e2['user']['score']): ?>
										<?php if ($e['user']['score'] > 0): ?>
											<td class="score lower-score tooltipable" data-title="This title was rated higher (<?php echo $e2['user']['score'] ?>) by the other user." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php else: ?>
											<td class="score no-score tooltipable" data-title="This title wasn&rsquo;t rated by this user." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php endif ?>
									<?php else: ?>
										<?php if ($e['user']['score'] > 0): ?>
											<td class="score same-score tooltipable" data-title="Both users rated this title equally." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php else: ?>
											<td class="score no-score tooltipable" data-title="None of users rated this title." data-sorter="<?php echo $e['user']['score'] ?>">
										<?php endif ?>
									<?php endif ?>
								<?php else: ?>
									<?php if (count($this->users) > 1): ?>
										<td class="score tooltipable" data-title="This title is unique to this user." data-sorter="<?php echo $e['user']['score'] ?>">
									<?php else: ?>
										<td class="score" data-sorter="<?php echo $e['user']['score'] ?>">
									<?php endif ?>
								<?php endif ?>
									<?php if (empty($e['user']['score'])): ?>
										-
									<?php else: ?>
										<?php echo $e['user']['score'] ?>
									<?php endif ?>
								</td>
							</tr>
						<?php endforeach ?>
					</tbody>

				</table>
			</div>
		<?php endif ?>

	</div>
</div>



<?php if ($this->isFinal): ?>
	<script type="text/javascript">
		$(function() {
			$('table').tablesorter({
				textExtraction: function(node) {
					return $(node).attr('data-sorter');
				},
				<?php if (count($this->users) > 1): ?>
					sortList: [[3,1],[2,0]]
				<?php else: ?>
					sortList: [[2,1],[1,0]]
				<?php endif ?>
			});
		});
	</script>
<?php endif ?>
